# H0U53 Collection Schema

Platform (house) definitions and configuration.

## Purpose

H0U53 stores platform-level configuration for casino platforms (FireKirin, OrionStars, etc.). It defines connection parameters, authentication settings, and platform-specific behaviors.

## Document Structure

```json
{
  "_id": "FireKirin",
  "Name": "Fire Kirin",
  "Platform": "FireKirin",
  "BaseUrl": "https://play.firekirin.in",
  "LoginUrl": "https://play.firekirin.in/web_mobile/login",
  "GameLobbyUrl": "https://play.firekirin.in/web_mobile/hallfirekirin",
  "ApiBaseUrl": "https://api.firekirin.in/v1",
  "WebSocketUrl": "wss://ws.firekirin.in/socket",
  "Enabled": true,
  "Configuration": {
    "Authentication": {
      "Type": "SessionCookie",
      "LoginEndpoint": "/api/auth/login",
      "TokenEndpoint": "/api/auth/token",
      "CookieName": "session_id"
    },
    "Polling": {
      "IntervalSeconds": 30,
      "TimeoutSeconds": 10,
      "RetryAttempts": 3
    },
    "RateLimiting": {
      "RequestsPerMinute": 60,
      "BurstAllowance": 10
    }
  },
  "Features": {
    "SupportsWebSocket": false,
    "SupportsBalanceAPI": true,
    "SupportsJackpotAPI": true,
    "RequiresCaptcha": false
  },
  "LastUpdated": "2026-01-15T10:30:00Z"
}
```

## Field Reference

### Core Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `_id` | string | Yes | Platform ID (primary key) |
| `Name` | string | Yes | Display name |
| `Platform` | string | Yes | Platform type identifier |
| `BaseUrl` | string | Yes | Base URL for platform |
| `LoginUrl` | string | No | Login page URL |
| `GameLobbyUrl` | string | No | Game lobby URL |
| `ApiBaseUrl` | string | No | API base URL |
| `WebSocketUrl` | string | No | WebSocket endpoint |
| `Enabled` | bool | Yes | Active status |
| `Configuration` | object | No | Platform-specific config |
| `Features` | object | No | Feature flags |
| `LastUpdated` | DateTime | No | Last modification time |

### Configuration Sub-Document

#### Authentication

| Field | Type | Description |
|-------|------|-------------|
| `Configuration.Authentication.Type` | string | Auth type (SessionCookie, Token, OAuth) |
| `Configuration.Authentication.LoginEndpoint` | string | Login API endpoint |
| `Configuration.Authentication.TokenEndpoint` | string | Token refresh endpoint |
| `Configuration.Authentication.CookieName` | string | Session cookie name |

#### Polling

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `Configuration.Polling.IntervalSeconds` | int | 30 | Seconds between polls |
| `Configuration.Polling.TimeoutSeconds` | int | 10 | Request timeout |
| `Configuration.Polling.RetryAttempts` | int | 3 | Retry count |

#### Rate Limiting

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `Configuration.RateLimiting.RequestsPerMinute` | int | 60 | Max requests/minute |
| `Configuration.RateLimiting.BurstAllowance` | int | 10 | Burst allowance |

### Features Sub-Document

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `Features.SupportsWebSocket` | bool | false | WebSocket support |
| `Features.SupportsBalanceAPI` | bool | true | Balance API available |
| `Features.SupportsJackpotAPI` | bool | true | Jackpot API available |
| `Features.RequiresCaptcha` | bool | false | CAPTCHA required |

## Validation Rules

```javascript
{
  $jsonSchema: {
    bsonType: "object",
    required: ["_id", "Name", "Platform", "BaseUrl", "Enabled"],
    properties: {
      _id: { bsonType: "string" },
      Name: { bsonType: "string" },
      Platform: { bsonType: "string" },
      BaseUrl: { bsonType: "string", pattern: "^https?://" },
      Enabled: { bsonType: "bool" }
    }
  }
}
```

## Indexes

```javascript
// Primary key (automatic)
{ _id: 1 }

// Platform type queries
db.H0U53.createIndex({ "Platform": 1 })

// Active platforms
db.H0U53.createIndex({ "Enabled": 1 })
```

## Common Queries

### Get Platform Config
```javascript
// By ID
db.H0U53.findOne({ "_id": "FireKirin" })

// Active platforms
db.H0U53.find({ "Enabled": true })

// All platforms
db.H0U53.find()
```

### Update Configuration
```javascript
db.H0U53.updateOne(
  { "_id": "FireKirin" },
  {
    $set: {
      "Configuration.Polling.IntervalSeconds": 45,
      "LastUpdated": new Date()
    }
  }
)
```

## Platform Types

| Platform | Description | Implementation |
|----------|-------------|----------------|
| `FireKirin` | Fire Kirin platform | HTTP API polling |
| `OrionStars` | Orion Stars platform | WebSocket + HTTP |
| `Gold777` | Gold 777 platform | HTTP API |

## Code Examples

### Reading Platform Config (C#)
```csharp
public async Task<House> GetHouseAsync(string houseId)
{
    return await houseRepo.GetAsync(houseId);
}

public async Task<IEnumerable<House>> GetActiveHousesAsync()
{
    return await houseRepo.FindAsync(h => h.Enabled);
}
```

### Creating Balance Provider (C#)
```csharp
public IBalanceProvider CreateBalanceProvider(string houseId)
{
    var house = await houseRepo.GetAsync(houseId);
    
    return house.Platform switch
    {
        "FireKirin" => new FireKirinBalanceProvider(house),
        "OrionStars" => new OrionStarsBalanceProvider(house),
        _ => throw new NotSupportedException($"Platform {house.Platform} not supported")
    };
}
```

### Platform-Specific Login (C#)
```csharp
public async Task LoginAsync(Credential credential)
{
    var house = await houseRepo.GetAsync(credential.House);
    
    switch (house.Configuration.Authentication.Type)
    {
        case "SessionCookie":
            await LoginWithSessionCookieAsync(credential, house);
            break;
            
        case "Token":
            await LoginWithTokenAsync(credential, house);
            break;
            
        default:
            throw new NotSupportedException(
                $"Auth type {house.Configuration.Authentication.Type} not supported");
    }
}
```

## Integration Points

### Written By
- **Setup Scripts**: Initial platform configuration
- **Admin Tools**: Platform updates

### Read By
- **H0UND**: Polling configuration
- **H4ND**: Login automation
- **C0MMON**: Balance provider factory

## Best Practices

1. **Consistent IDs**: Match CRED3N7IAL.House values
2. **URL Validation**: Ensure URLs are reachable
3. **Feature Flags**: Test features before enabling
4. **Rate Limits**: Respect platform limits
5. **Documentation**: Comment on platform quirks

## Troubleshooting

### Connection Failures
1. Verify URLs are correct
2. Check network connectivity
3. Review rate limiting
4. Check platform status

### Authentication Failures
1. Verify auth type configured
2. Check credential format
3. Review login endpoint
4. Check for CAPTCHA

---

**Related**: [Data Models Overview](../INDEX.md) | [CRED3N7IAL Collection](CRED3N7IAL.md) | [G4ME Collection](G4ME.md)
